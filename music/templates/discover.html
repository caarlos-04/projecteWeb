{% extends 'base.html' %}
{% load static %}
{% block title %}Discover new music{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'music.css' %}?v={{ timestamp }}">

<div class="info-container">
    <h1>Recommendations for {{ user.username }}</h1>
    <p>Explore new music based on your taste</p>
</div>

<div class="song-select-header">
    <h1>Selecciona a time range</h1>
    <select id="timeRangeSelect">
        <option value="short_term">Last month</option>
        <option value="medium_term" selected>Last 6 months</option>
        <option value="long_term">Last years</option>
    </select>
</div>

<div id="recommendationContainer">
    <!-- Recomanacions carregades din√†micament -->
</div>

<script>
function loadRecommendations(timeRange) {
    const container = document.getElementById('recommendationContainer');
    container.innerHTML = "<p>Loading recommendations...</p>";

    fetch(`/music/recommendations/?time_range=${timeRange}`)
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            container.innerHTML = '';
            if (data.recommendations && data.recommendations.length > 0) {
                let count = 1;
                data.recommendations.forEach(track => {
                    const div = document.createElement('div');
                    div.innerHTML = `
                        <div class="song-card">
                            <img src="${track.image}" alt="${track.name}">
                            <h3>${count}. ${track.name}</h3>
                            <p style="color:#999;">${track.artist}</p>
                        </div>
                    `;
                    container.appendChild(div);
                    count++;
                });
            } else {
                container.innerHTML = "<p>No s'han trobat recomanacions per aquest per√≠ode.</p>";
            }
        })
        .catch(error => {
            container.innerHTML = "<p>Error carregant recomanacions.</p>";
            console.error("Error carregant recomanacions:", error);
        });
}

document.getElementById('timeRangeSelect').addEventListener('change', function () {
    const timeRange = this.value;
    if (timeRange) {
        loadRecommendations(timeRange);
    }
});

// üîπ Carrega inicial amb medium_term (preseleccionat)
document.addEventListener('DOMContentLoaded', () => {
    const defaultRange = document.getElementById('timeRangeSelect').value;
    loadRecommendations(defaultRange);
});
</script>

<style>
    #recommendationContainer {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
        margin-top: 2rem;
    }

    /* Hereta els estils de song-card, etc., que ja tens */
</style>
{% endblock %}
